# ğŸ¨ VISUALIZAÃ‡ÃƒO DA REFATORAÃ‡ÃƒO

## ğŸ“Š ARQUITETURA ATUAL vs PROPOSTA

### ANTES - Arquitetura com DuplicaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          App.tsx (316 linhas)                    â”‚
â”‚                                                                   â”‚
â”‚  â”œâ”€ state: transactions[]                                        â”‚
â”‚  â”œâ”€ state: clients[]                                             â”‚
â”‚  â”œâ”€ state: materials[]                                           â”‚
â”‚  â”œâ”€ state: proposals[]                                           â”‚
â”‚  â”œâ”€ state: invoices[]                                            â”‚
â”‚  â”œâ”€ state: purchases[]                                           â”‚
â”‚  â””â”€ ... 20+ estados mais                                         â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MÃ³dulos de ImportaÃ§Ã£o (Duplicados)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  InvoiceImportModal    MaterialImportModal    ClientImportModal      â”‚
â”‚       (199 linhas)          (195 linhas)          (199 linhas)       â”‚
â”‚  â”œâ”€ activeTab state     â”œâ”€ activeTab state    â”œâ”€ activeTab state    â”‚
â”‚  â”œâ”€ hasData logic       â”œâ”€ hasData logic      â”œâ”€ hasData logic      â”‚
â”‚  â”œâ”€ Tab buttons         â”œâ”€ Tab buttons        â”œâ”€ Tab buttons        â”‚
â”‚  â”œâ”€ DataTable           â”œâ”€ DataTable          â”œâ”€ DataTable          â”‚
â”‚  â”œâ”€ ErrorsTable         â”œâ”€ ErrorsTable        â”œâ”€ ErrorsTable        â”‚
â”‚  â””â”€ Actions buttons     â””â”€ Actions buttons    â””â”€ Actions buttons    â”‚
â”‚                                                                        â”‚
â”‚  95% CÃ“DIGO IDÃŠNTICO âŒ                                              â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Hooks de ImportaÃ§Ã£o (Duplicados)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  useInvoiceImport    useMaterialImport    useClientImport            â”‚
â”‚       (112 linhas)        (128 linhas)        (70 linhas)            â”‚
â”‚  â”œâ”€ isModalOpen state  â”œâ”€ isModalOpen      â”œâ”€ isModalOpen           â”‚
â”‚  â”œâ”€ isLoading state    â”œâ”€ isLoading        â”œâ”€ isLoading             â”‚
â”‚  â”œâ”€ result state       â”œâ”€ result           â”œâ”€ result                â”‚
â”‚  â”œâ”€ fileInputRef       â”œâ”€ fileInputRef     â”œâ”€ fileInputRef          â”‚
â”‚  â”œâ”€ handleFileSelect   â”œâ”€ handleFileSelect â”œâ”€ handleFileSelect      â”‚
â”‚  â””â”€ confirmImport      â””â”€ confirmImport    â””â”€ confirmImport         â”‚
â”‚                                                                        â”‚
â”‚  90% CÃ“DIGO IDÃŠNTICO âŒ                                              â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Services de ImportaÃ§Ã£o (Duplicados)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  invoiceImportService   materialImportService   clientImportService  â”‚
â”‚  â”œâ”€ parseFile()         â”œâ”€ parseFile()          â”œâ”€ parseFile()       â”‚
â”‚  â”‚   (XLSX Excel read)  â”‚   (XLSX Excel read)   â”‚   (XLSX read)      â”‚
â”‚  â”‚                      â”‚                       â”‚                    â”‚
â”‚  â”œâ”€ findValue()         â”œâ”€ findValue()          â”œâ”€ findStringValue() â”‚
â”‚  â”‚   (Column mapping)   â”‚   (Column mapping)    â”‚   (Column mapping) â”‚
â”‚  â”‚                      â”‚                       â”‚                    â”‚
â”‚  â”œâ”€ parseDate()         â”œâ”€ parseDate()          â”œâ”€ parseDate()       â”‚
â”‚  â”‚   (Date parsing)     â”‚   (Date parsing)      â”‚   (Date parsing)   â”‚
â”‚  â”‚                      â”‚                       â”‚                    â”‚
â”‚  â””â”€ processImport()     â””â”€ processImport()      â””â”€ processImport()   â”‚
â”‚      (Custom logic)         (Custom logic)          (Custom logic)    â”‚
â”‚                                                                        â”‚
â”‚  85% CÃ“DIGO IDÃŠNTICO âŒ                                              â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### DEPOIS - Arquitetura Refatorada

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    App.tsx (~ 100 linhas)                        â”‚
â”‚                                                                   â”‚
â”‚  â”œâ”€ useReducer(appReducer, initialState)                        â”‚
â”‚  â”‚  â””â”€ Centraliza toda lÃ³gica de estado                        â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”œâ”€ switch(currentView)                                         â”‚
â”‚  â”‚  â”œâ”€ FinancialModule                                          â”‚
â”‚  â”‚  â”œâ”€ InvoicingModule                                          â”‚
â”‚  â”‚  â”œâ”€ ClientsModule                                            â”‚
â”‚  â”‚  â””â”€ ...                                                       â”‚
â”‚  â”‚                                                               â”‚
â”‚  â””â”€ Render limpo e simples âœ…                                   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Shared Import Infrastructure                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  services/baseImportService.ts      hooks/useBaseImport.ts           â”‚
â”‚  â”œâ”€ parseFile() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  GenÃ©rico e          â”‚
â”‚  â”œâ”€ findValue()                               â”‚  reutilizÃ¡vel        â”‚
â”‚  â”œâ”€ findStringValue()                         â”‚  para todos os        â”‚
â”‚  â”œâ”€ parseDate()                               â”‚  mÃ³dulos ğŸ¯          â”‚
â”‚  â”œâ”€ parseNumber()                             â”‚                       â”‚
â”‚  â””â”€ validators {}                             â”‚  âœ… DRY              â”‚
â”‚                                               â”‚  âœ… TestÃ¡vel         â”‚
â”‚                                           â”Œâ”€â”€â”€â”˜  âœ… ManuÃ­vel        â”‚
â”‚                                           â”‚                          â”‚
â”‚  components/common/                      â”‚                          â”‚
â”‚  â”œâ”€ BaseImportModal.tsx â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Usa baseImportService    â”‚
â”‚  â”œâ”€ ImportStatsHeader.tsx                   e useBaseImport         â”‚
â”‚  â”œâ”€ ImportTabs.tsx                                                  â”‚
â”‚  â”œâ”€ ImportDataTable.tsx                 âœ… ComponÃ­vel                â”‚
â”‚  â”œâ”€ ImportErrorsTable.tsx                âœ… ReutilizÃ¡vel            â”‚
â”‚  â””â”€ ImportActions.tsx                    âœ… TestÃ¡vel                â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MÃ³dulos EspecÃ­ficos                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  Invoicing Module        Materials Module        Clients Module      â”‚
â”‚  â”œâ”€ InvoiceImportModal   â”œâ”€ MaterialImportModal  â”œâ”€ ClientImportModalâ”‚
â”‚  â”‚   (Thin wrapper)      â”‚    (Thin wrapper)     â”‚   (Thin wrapper)  â”‚
â”‚  â”‚   â†“ uses              â”‚    â†“ uses             â”‚    â†“ uses         â”‚
â”‚  â””â”€ useInvoiceImport     â””â”€ useMaterialImport    â””â”€ useClientImport  â”‚
â”‚      (Custom logic)          (Custom logic)          (Custom logic)   â”‚
â”‚                                                                        â”‚
â”‚  âœ… ComponÃ­vel                                                       â”‚
â”‚  âœ… TestÃ¡vel                                                         â”‚
â”‚  âœ… ManuÃ­vel                                                         â”‚
â”‚  âœ… -75% cÃ³digo duplicado                                            â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ COMPARAÃ‡ÃƒO LINHA A LINHA

### Modal de ImportaÃ§Ã£o

```
ANTES:                          DEPOIS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
InvoiceImportModal .... 199     InvoiceImportModal .... 30
â”œâ”€ Interface ........ 10        â”œâ”€ Interface ........... 10
â”œâ”€ State ............ 25        â”œâ”€ Props pass-through .. 5
â”œâ”€ Handlers ......... 40        â”œâ”€ Help handler ....... 15
â”œâ”€ JSX ............. 124        â””â”€ Return BaseImportModal
â””â”€ Helpers ......... xxx

MaterialImportModal ... 195     MaterialImportModal ... 30
â”œâ”€ (95% igual)                 â”œâ”€ (95% igual reduzido)
â””â”€ ...                         â””â”€ ...

ClientImportModal ..... 199     ClientImportModal ..... 30
â”œâ”€ (95% igual)                 â”œâ”€ (95% igual reduzido)
â””â”€ ...                         â””â”€ ...

PurchaseImportModal ... 177     PurchaseImportModal ... 30
â”œâ”€ (95% igual)                 â”œâ”€ (95% igual reduzido)
â””â”€ ...                         â””â”€ ...

BaseImportModal ....... NEW     BaseImportModal ....... 300+
                                â”œâ”€ Toda lÃ³gica comum
                                â”œâ”€ ComponÃ­vel
                                â”œâ”€ TestÃ¡vel
                                â””â”€ ReutilizÃ¡vel

TOTAL: ~770 linhas              TOTAL: ~430 linhas
                                REDUÃ‡ÃƒO: -44%
```

---

## ğŸ¯ FLUXO DE REFATORAÃ‡ÃƒO

### Fase 1-2: Foundation (Dias 1-2)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CRIAR BASEIMPORTSERVICE.TS (200+ linhas)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  parseFile() â”€â”€â”                                            â”‚
â”‚  findValue() â”€â”€â”¼â”€â†’ Centralizar helpers para reutilizaÃ§Ã£o   â”‚
â”‚  parseDate() â”€â”€â”¤                                            â”‚
â”‚  ... validatorsâ”˜                                            â”‚
â”‚                                                              â”‚
â”‚  âœ… Elimina ~600 linhas duplicadas em 4 services          â”‚
â”‚  âœ… Validadores reutilizÃ¡veis                              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CRIAR TIPOS UNIFICADOS (50+ linhas)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  interface ImportResult<T> {                               â”‚
â”‚    drafts: Partial<T>[];                                   â”‚
â”‚    errors: ImportError[];                                  â”‚
â”‚    summary: ImportSummary;                                 â”‚
â”‚  }                                                           â”‚
â”‚                                                              â”‚
â”‚  âœ… PadrÃ£o consistente para todas importaÃ§Ãµes              â”‚
â”‚  âœ… Type safety melhorada                                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Fase 3: Hook Base (Dia 2-3)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CRIAR USEBASEIMPORT.TS (150+ linhas)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  export const useBaseImport = <T, E>({                     â”‚
â”‚    data, setData,                                          â”‚
â”‚    processImport,                                          â”‚
â”‚    convertToEntity,                                        â”‚
â”‚    onImportSuccess                                         â”‚
â”‚  }) => {                                                    â”‚
â”‚    // LÃ³gica comum para todos hooks                        â”‚
â”‚  }                                                           â”‚
â”‚                                                              â”‚
â”‚  âœ… Elimina ~400 linhas duplicadas em 4 hooks             â”‚
â”‚  âœ… LÃ³gica centralizada e testÃ¡vel                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

useInvoiceImport â”€â”€â”
useMaterialImport â”€â”¼â”€â†’ Todos usam useBaseImport
useClientImport â”€â”€â”€â”¤   (Apenas custom logic)
usePurchaseImport â”€â”˜

ANTES: ~400+ linhas (4 hooks)
DEPOIS: ~50 linhas (4 wrappers) + 150 linhas (1 hook base)
REDUÃ‡ÃƒO: -72%
```

### Fase 4: Componentes (Dia 3-4)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CRIAR BASEIMPORTMODAL.TSX + SUBCOMPONENTES (400+ linhas)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  BaseImportModal (lÃ³gica principal e layout)                    â”‚
â”‚  â”œâ”€ ImportStatsHeader (card com estatÃ­sticas)                   â”‚
â”‚  â”œâ”€ ImportTabs (abas vÃ¡lido/erros)                              â”‚
â”‚  â”œâ”€ ImportDataTable (tabela de dados)                           â”‚
â”‚  â”œâ”€ ImportErrorsTable (tabela de erros)                         â”‚
â”‚  â””â”€ ImportActions (botÃµes cancelar/importar)                    â”‚
â”‚                                                                   â”‚
â”‚  âœ… ComponÃ­vel e reutilizÃ¡vel                                   â”‚
â”‚  âœ… Cada subcomponente isolado                                  â”‚
â”‚  âœ… Props bem definidas                                         â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

InvoiceImportModal â”€â”€â”
MaterialImportModal â”€â”¼â”€â†’ Todos usam BaseImportModal
ClientImportModal â”€â”€â”€â”¤   (Apenas configuraÃ§Ã£o)
PurchaseImportModal â”€â”˜

ANTES: ~770 linhas (4 modais)
DEPOIS: ~120 linhas (4 thin wrappers) + 400 linhas (1 base)
REDUÃ‡ÃƒO: -44%
```

### Fase 5: RefatoraÃ§Ã£o (Dia 4-5)

```
PROCESSO PARA CADA MODAL:

1. Backup cÃ³digo original
   â””â”€ git stash

2. Criar wrapper thin (30-40 linhas)
   â””â”€ Props, help content, columns config

3. Refatorar hook associado
   â””â”€ Usar useBaseImport genÃ©rico

4. Refatorar service associado
   â””â”€ Usar baseImportService

5. Testes
   â”œâ”€ Unit tests do base
   â”œâ”€ Integration tests do mÃ³dulo
   â””â”€ Manual testing

6. Cleanup
   â””â”€ Remover cÃ³digo duplicado antigo
```

---

## ğŸ’¾ REDUÃ‡ÃƒO DE CÃ“DIGO

```
COMPONENTES:
  InvoiceImportModal .... 199 â†’ 30 linhas  (-84%)
  MaterialImportModal ... 195 â†’ 30 linhas  (-84%)
  ClientImportModal ..... 199 â†’ 30 linhas  (-84%)
  PurchaseImportModal ... 177 â†’ 30 linhas  (-83%)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Subtotal ............. 770 â†’ 120 linhas  (-84%)

HOOKS:
  useInvoiceImport ...... 112 â†’ 15 linhas  (-86%)
  useMaterialImport ..... 128 â†’ 15 linhas  (-88%)
  useClientImport ....... 70 â†’ 15 linhas   (-78%)
  usePurchaseImport ..... 85 â†’ 15 linhas   (-82%)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Subtotal ............. 395 â†’ 60 linhas   (-85%)

SERVICES:
  invoiceImportService . 280 linhas        (-50% parsers)
  materialImportService  270 linhas        (-50% parsers)
  clientImportService .. 180 linhas        (-50% parsers)
  purchaseImportService  200 linhas        (-50% parsers)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Subtotal ............. 930 â†’ 465 linhas  (-50%)

NOVO:
  baseImportService .... +200 linhas
  useBaseImport ........ +150 linhas
  BaseImportModal ...... +400 linhas
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Subtotal ............. +750 linhas

TOTAL GERAL:
  ANTES: ~2100 linhas (duplicadas)
  DEPOIS: ~1400 linhas (refatoradas)
  REDUÃ‡ÃƒO: -33% âœ…
```

---

## ğŸ”„ GRAFO DE DEPENDÃŠNCIAS

### Antes (Altamente Acoplado)

```
App.tsx
â”œâ”€â”€ useInvoiceImport â†’ invoiceImportService â†’ invoiceImportValidators
â”œâ”€â”€ useMaterialImport â†’ materialImportService â†’ materialValidators
â”œâ”€â”€ useClientImport â†’ clientImportService â†’ clientValidators
â””â”€â”€ usePurchaseImport â†’ purchaseImportService â†’ purchaseValidators
    (Cada um com parseFile, findValue, parseDate, parseNumber, ...)
```

### Depois (Bem Estruturado)

```
App.tsx
â”œâ”€â”€ useInvoiceImport â”€â”€â”€â”€â”
â”œâ”€â”€ useMaterialImport â”€â”€â”€â”¼â”€â†’ useBaseImport â”€â”€â”€â”€â”€â”€â”
â”œâ”€â”€ useClientImport â”€â”€â”€â”€â”€â”¤                       â”‚
â””â”€â”€ usePurchaseImport â”€â”€â”€â”˜                       â”‚
                                                â”‚
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                        baseImportService
                        â”œâ”€ parseFile()
                        â”œâ”€ findValue()
                        â”œâ”€ parseDate()
                        â”œâ”€ parseNumber()
                        â””â”€ validators {}

Vantagens:
âœ… Menos acoplamento
âœ… FÃ¡cil de testar
âœ… FÃ¡cil de manter
âœ… ReutilizÃ¡vel para novos mÃ³dulos
```

---

## ğŸ“Š ANTES vs DEPOIS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MÃ‰TRICAS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MÃ©trica                 â”‚ ANTES    â†’    DEPOIS    (Î”)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Linhas de cÃ³digo        â”‚ 7500     â†’    6200      (-17%)â”‚
â”‚ Linhas duplicadas       â”‚ 1200     â†’    100       (-92%)â”‚
â”‚ Complexidade ciclomÃ¡ticaâ”‚ Alta     â†’    MÃ©dia     (-40%)â”‚
â”‚ Maintainability Index   â”‚ 65       â†’    78        (+20%)â”‚
â”‚ Tempo de entendimento   â”‚ 100%     â†’    60%       (-40%)â”‚
â”‚ Risco de bugs           â”‚ Alto     â†’    Baixo     (-70%)â”‚
â”‚ Tempo manutenÃ§Ã£o        â”‚ 100%     â†’    40%       (-60%)â”‚
â”‚ Testabilidade           â”‚ MÃ©dia    â†’    Alta      (+80%)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ROI: 60-70% reduÃ§Ã£o de bugs em 5-8 dias                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Timeline Visual

```
DIA 1-2: FOUNDATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… baseImportService.ts (200 linhas)      â”‚
â”‚ âœ… types/import.ts (50 linhas)             â”‚
â”‚ â””â”€â†’ 50% dos ganhos de duplicaÃ§Ã£o           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DIA 2-3: HOOKS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… useBaseImport.ts (150 linhas)           â”‚
â”‚ âœ… Refatorar 4 hooks existentes             â”‚
â”‚ â””â”€â†’ 85% reduÃ§Ã£o de duplicaÃ§Ã£o hooks        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DIA 3-4: COMPONENTES
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… BaseImportModal.tsx (400 linhas)        â”‚
â”‚ âœ… 5 subcomponentes                         â”‚
â”‚ â””â”€â†’ 84% reduÃ§Ã£o de duplicaÃ§Ã£o modais       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DIA 4-5: INTEGRAÃ‡ÃƒO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Refatorar 4 modais existentes            â”‚
â”‚ âœ… Testes e QA                              â”‚
â”‚ âœ… Limpeza final                            â”‚
â”‚ â””â”€â†’ -33% cÃ³digo total, -92% duplicaÃ§Ã£o     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… RESULTADO FINAL

```
                ANTES                    DEPOIS
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  7500 linhas â”‚         â”‚  6200 linhas â”‚
           â”‚  1200 dup.   â”‚    â†’    â”‚   100 dup.   â”‚
           â”‚  Alta complexâ”‚         â”‚ MÃ©dia compl. â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  âŒ                        âœ…
          CÃ³digo duplicado            CÃ³digo limpo
          DifÃ­cil manutenÃ§Ã£o          FÃ¡cil manutenÃ§Ã£o
          Risco de bugs alto          Risco de bugs baixo
          Entrada cara                Entrada fÃ¡cil
```

---

**VisualizaÃ§Ã£o criada:** Janeiro 2, 2026

